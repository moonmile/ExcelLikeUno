# 設計方針

UNO API の複雑さを隠し、「Python の 1 クラス = Calc の 1 つの概念」として扱えるようにする。

- UNO オブジェクトを保持するラッパーの基底クラスを作る
- Calc 用のラッパーは、この基底クラスを継承する
- Spreadsheet, Range, Sheet なども同じパターンで統一
- インターフェース名を定数化して IDE 補完を効かせる
- 型ヒントを Protocol で定義して IDE 補完を強化

## 開発コード例

以下は、開発コード例です。

### UnoObject

```python
class UnoObject:
    def __init__(self, obj):
        self._obj = obj
        self._cache = {}

    def iface(self, name):
        if name not in self._cache:
            self._cache[name] = self._obj.queryInterface(name)
        return self._cache[name]
```

## Cell

```python
class Cell(UnoObject):
    @property
    def value(self):
        return self.iface("com.sun.star.table.XCell").getValue()

    @value.setter
    def value(self, v):
        self.iface("com.sun.star.table.XCell").setValue(v)

    @property
    def formula(self):
        return self.iface("com.sun.star.table.XCell").getFormula()

    @formula.setter
    def formula(self, f):
        self.iface("com.sun.star.table.XCell").setFormula(f)

    @property
    def props(self):
        return self.iface("com.sun.star.beans.XPropertySet")
```

## 利用時の例

```python
import uno
import excellikeuno as elu

(desktop, document, sheet) = uno.connect_to_calc()
cell = sheet.getCellByPosition(0, 0)  # A1 セルを取得
cell.value = 100
cell.formula = "=A1+B1"

print(cell.props.getPropertyValue("CellBackColor"))  # props 経由で取得
print(cell.CellBackColor) # 直接取得も可能

sheet.cell(1, 0).value = 200  # B1 セルを取得して値を設定
sheet.cell(2, 0).formula = "=A1+B1"  # C1 セルに数式を設定

``` 

## CellProperties の公開属性を Cell 直下で提供

CellProperties Service の Public Attributes は Cell のプロパティとして直接アクセスできる（props 経由も可）。主な属性名:

- CellStyle, CellBackColor, IsCellBackgroundTransparent
- HoriJustify, VertJustify, IsTextWrapped, ParaIndent, Orientation, RotateAngle, RotateReference, AsianVerticalMode
- TableBorder, TopBorder, BottomBorder, LeftBorder, RightBorder, NumberFormat, ShadowFormat, CellProtection, UserDefinedAttributes
- DiagonalTLBR, DiagonalBLTR, ShrinkToFit
- TableBorder2, TopBorder2, BottomBorder2, LeftBorder2, RightBorder2, DiagonalTLBR2, DiagonalBLTR2
- CellInteropGrabBag

例: `sheet.cell(0, 0).CellBackColor = 0x112233` で背景色を設定。

# 参照ドキュメント

Spreadsheet Service Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a23852.html
CellProperties Service Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a24712.html
BorderLine Struct Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a24692.html
TableBorder Struct Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a24740.html
BorderLine2 Struct Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a24696.html
TableBorder2 Struct Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a24744.html
enum CellHoriJustify: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a13049.html#ab3c576b107bd5018643ab5612438fdf2
enum CellVertJustify: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a13049.html#a17834bec5bf9ac4432141dee1c03b50b

Shape Service Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a25352.html
ConnectorShape Service Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a18256.html
LineShape Service Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a18540.html
RectangleShape Service Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a18616.html
EllipseShape Service Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a18308.html

PolyLineShape Service Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a18584.html
PolyPolygonShape Service Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a18604.html
TextShape Service Reference: file:///C:/Program%20Files/LibreOffice/sdk/docs/idl/ref/a18656.html



